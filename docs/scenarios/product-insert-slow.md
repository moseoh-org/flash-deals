# 상품 대량 등록이 느림

## 상황

프로덕션 환경에서 1,000만 건 이상의 상품 데이터가 누적된 상태.
UUID v4의 랜덤 특성으로 인해 B-Tree 인덱스 페이지 분할이 빈번하게 발생하여 INSERT 성능이 저하될 것으로 예상했다.

## 테스트 환경

- 부하 테스트: `make load-product-insert`
- 최대 VU: 10
- 테스트 대상: `POST /products` (상품 등록)
- 기존 데이터: 0건 / 100만 건 / 1,000만 건

---

## 기존 시스템

### 성능 (데이터 규모별)

| 기존 데이터 | p95 응답시간 | 평균 응답시간 | 처리량   |
| ----------- | ------------ | ------------- | -------- |
| 0건         | 179ms        | 145ms         | 64req/s  |
| 100만 건    | 188ms        | 149ms         | 60req/s  |
| 1,000만 건  | 180ms        | 148ms         | 61req/s  |

### 리소스 사용량 (1,000만 건)

| 컨테이너 | CPU |
| -------- | --- |
| postgres | 7%  |
| product  | 19% |
| gateway  | 29% |

### 결론

- **UUID v4 성능 저하가 관찰되지 않음**
- 1,000만 건에서도 INSERT 성능 차이가 미미함 (5% 이내)
- PostgreSQL B-Tree 인덱스가 충분히 최적화되어 있음
- 인덱스가 메모리에 캐싱되어 페이지 분할 비용이 낮음

---

## 비고

UUID v4→v7 전환은 이론적으로 유효하나, 현재 테스트 환경(로컬 Docker, 1,000만 건)에서는 유의미한 성능 차이를 재현하기 어려움.
더 대규모 환경(1억 건 이상, 디스크 I/O 병목 발생 시)에서 효과가 있을 것으로 예상됨.
