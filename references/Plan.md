# PLAN.md: Project Flash Deal

> **High Concurrency & Polyglot MSA Architecture Portfolio**
> 4ë…„ ì°¨ ë°±ì—”ë“œ ê°œë°œìì˜ ê¸°ìˆ  ê²€ì¦ ë° ì„±ëŠ¥ ìµœì í™” R&D í”„ë¡œì íŠ¸

## 1. Project Overview

**ëª©í‘œ:** ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” 'ì„ ì°©ìˆœ í•«ë”œ' ì‹œìŠ¤í…œì„ MSAë¡œ êµ¬ì¶•í•˜ë©°, ë‹¨ê³„ë³„ ì•„í‚¤í…ì²˜ ì§„í™”ì™€ ì–¸ì–´ë³„ ì„±ëŠ¥ ì°¨ì´ë¥¼ ì •ëŸ‰ì ìœ¼ë¡œ ì¦ëª…í•œë‹¤.

### ğŸ›  Core Tech Stack (Phase 1)

- **Language:** Python 3.12 (FastAPI)
- **Database:** PostgreSQL 16 (Asyncpg driver)
- **ORM/Query:** `sqlc` (SQL First Code Generation)
- **Migration:** `golang-migrate` (ì–¸ì–´ ë…ë¦½ì  SQL ë§ˆì´ê·¸ë ˆì´ì…˜)
- **Architecture:** Microservices (Docker Compose base)
- **Communication:** REST API (HTTP 1.1)

---

## 2. Roadmap & Milestones

### ğŸš€ Phase 1: MVP êµ¬ì¶• (The Foundation)

**ëª©í‘œ:** ê°€ì¥ ë‹¨ìˆœí•œ êµ¬ì¡°ë¡œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ë¡œê·¸ì¸, ìƒí’ˆì¡°íšŒ, ì£¼ë¬¸)ì´ ë™ì‘í•´ì•¼ í•œë‹¤.

- [x] **1. API Contract Definition (API First)**
  - [x] api-spec/auth-service.v1.yaml ì‘ì„±
  - [x] api-spec/product-service.v1.yaml ì‘ì„±
  - [x] api-spec/order-service.v1.yaml ì‘ì„±
  - [x] Review: ê° ëª…ì„¸ì„œì˜ Request/Response í•„ë“œ í™•ì •
- [x] **2. ì¸í”„ë¼ ê¸°ë³¸ ì„¤ì •**
  - [x] Monorepo í´ë” êµ¬ì¡° ìƒì„± (services/, infra/, tests/)
  - [x] Docker Compose í™˜ê²½ êµ¬ì„± (PostgreSQL, Redis)
- [x] **3. Gateway (Python FastAPI)** - ê¸°ë³¸ ë¼ìš°íŒ…
  - [x] Dockerfile, pyproject.toml ì„¤ì • (uv ì‚¬ìš©)
  - [x] `httpx`ë¥¼ ì´ìš©í•œ ìš”ì²­ ë¼ìš°íŒ… (Proxy)
  - [x] ê³µê°œ ê²½ë¡œ(`/auth/*`) ì„¤ì •
- [x] **4. Auth Service (Python)**
  - [x] DB Schema/Query ì‘ì„± ë° sqlc ì„¤ì •
  - [x] JWT ë°œê¸‰ ë° ê²€ì¦ ë¡œì§ êµ¬í˜„
  - [x] User íšŒì›ê°€ì…/ë¡œê·¸ì¸ API
- [x] **5. Gateway ê³ ë„í™”** - JWT ê²€ì¦ ì¶”ê°€
  - [x] JWT ê²€ì¦ Middleware êµ¬í˜„
  - [x] ì¸ì¦ í•„ìš” ê²½ë¡œì— Middleware ì ìš©
- [x] **6. Product Service (Python)**
  - [x] DB Schema/Query ì‘ì„± ë° sqlc ì„¤ì •
  - [x] ìƒí’ˆ ë“±ë¡ ë° ì¬ê³  ì¡°íšŒ API
  - [x] í•«ë”œ API
- [x] **7. Order Service (Python)**
  - [x] DB Schema/Query ì‘ì„± ë° sqlc ì„¤ì •
  - [x] ì£¼ë¬¸ ìƒì„± API (ë‹¨ìˆœ DB Transaction)
- [x] **8. í†µí•© Makefile ì™„ì„±**
  - [x] ë¹Œë“œ, ì‹¤í–‰, í…ŒìŠ¤íŠ¸ ìë™í™” ëª…ë ¹ì–´

### ğŸ“Š Phase 2: ì¸¡ì • í™˜ê²½ êµ¬ì¶• (The Baseline)

**ëª©í‘œ:** ìµœì í™” ì „, í˜„ì¬ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ ì§€í‘œë¥¼ ìˆ˜ì§‘í•˜ì—¬ ë¹„êµêµ°(Control Group)ì„ í˜•ì„±í•œë‹¤.

- [x] **Integration Testing (API)**
  - [x] **Tool:** `pytest-playwright` (Python, uv ì‚¬ìš©)
  - [x] **Location:** `tests/integration/` (ì„œë¹„ìŠ¤ ë…ë¦½ì , API ëª…ì„¸ ê¸°ë°˜)
  - [x] API Spec(Swagger) ê¸°ë°˜ì˜ í†µí•© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‘ì„± (Code-based)
  - [ ] CI íŒŒì´í”„ë¼ì¸ ì—°ë™ ì¤€ë¹„ (Github Actions ë“±)
- [x] **Observability (Monitoring)**
  - [x] **Tool:** OpenTelemetry + Grafana Stack (Tempo, Prometheus)
  - [x] Python ì•±ì— OTel Auto-Instrumentation ì ìš©
  - [x] í†µí•© ëŒ€ì‹œë³´ë“œ êµ¬ì„± (Traces, Metrics)
- [x] **Load Testing (Performance)**
  - [x] **Tool:** `k6`
  - [x] ì‹œë‚˜ë¦¬ì˜¤ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (health-check, auth-flow, order-scenario)
  - [x] Baseline ì„±ëŠ¥ ì¸¡ì • í™˜ê²½ êµ¬ì¶• ì™„ë£Œ

### âš¡ Phase 3: ë¹„ì¦ˆë‹ˆìŠ¤ ê³ ë„í™” (Concurrency & Caching)

**ëª©í‘œ:** 'ì„ ì°©ìˆœ êµ¬ë§¤'ì˜ í•µì‹¬ì¸ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì„±ëŠ¥ì„ ìµœì í™”í•œë‹¤.

- [ ] **Redis ë„ì…**
  - [ ] Global Caching ì „ëµ ìˆ˜ë¦½ (Product ì¡°íšŒ ì„±ëŠ¥ ê°œì„ )
  - [ ] **Distributed Lock (Redlock/Lua Script)** êµ¬í˜„: ì¬ê³  ì°¨ê° ë™ì‹œì„± ì´ìŠˆ í•´ê²°
- [ ] **Database Optimization**
  - [ ] PostgreSQL Index íŠœë‹ ë° ì‹¤í–‰ ê³„íš ë¶„ì„ (`EXPLAIN ANALYZE`)

### ğŸ§ª Phase 4: ì–¸ì–´ ì „í™˜ ì‹¤í—˜ (The R&D Experiment)

**ëª©í‘œ:** íŠ¹ì • ì„œë¹„ìŠ¤(Auth ë˜ëŠ” Order)ë¥¼ ê³ ì„±ëŠ¥ ì–¸ì–´ë¡œ êµì²´í•˜ì—¬ **"ë¹„ìš© ëŒ€ë¹„ ì„±ëŠ¥ íš¨ìœ¨"**ì„ ì¦ëª…í•œë‹¤.

- [ ] **Target ì„ ì •:** CPU ì—°ì‚°ì´ ë§ì€ `Auth Service` ë˜ëŠ” íŠ¸ë˜í”½ì´ ëª°ë¦¬ëŠ” `Order Service`
- [ ] **Re-implementation (Polyglot)**
  - [ ] **Golang** ë˜ëŠ” **Kotlin(Spring Boot)** ìœ¼ë¡œ í•´ë‹¹ ì„œë¹„ìŠ¤ ì¬ì‘ì„±
  - [ ] `sqlc` ì„¤ì •ì„ ë³€ê²½í•˜ì—¬ ë™ì¼í•œ SQLë¡œ Go/Kotlin ì½”ë“œ ìƒì„±
- [ ] **Performance Battle**
  - [ ] ë™ì¼í•œ `k6` í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
  - [ ] Python ë²„ì „ vs Go/Kotlin ë²„ì „ ì„±ëŠ¥ ë¹„êµ ë¦¬í¬íŠ¸ ì‘ì„± (Throughput, Memory Usage ë“±)

### ğŸ— Phase 5: ì•„í‚¤í…ì²˜ ì§„í™” (Event-Driven & Infra)

**ëª©í‘œ:** ì‹œìŠ¤í…œ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³  ìš´ì˜ ì•ˆì •ì„±ì„ í™•ë³´í•œë‹¤.

- [ ] **Message Queue ë„ì…**
  - [ ] Kafka (or RabbitMQ) êµ¬ì¶•
  - [ ] ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ ë¦¬íŒ©í† ë§: ë™ê¸° í˜¸ì¶œ(HTTP) -> ë¹„ë™ê¸° ì´ë²¤íŠ¸(Event-Driven)
- [ ] **Gateway ê³ ë„í™”**
  - [ ] Python Gateway -> **Kong Gateway** (ë˜ëŠ” Spring Cloud Gateway) ì „í™˜
  - [ ] Rate Limiting(ìœ ëŸ‰ ì œì–´) ì ìš©

---

## 3. Development Conventions

### ğŸ“œ API First Design

- ì½”ë”© ì „ **OpenAPI(Swagger) Spec**ì„ ë¨¼ì € ì‘ì„±í•œë‹¤.
- ì–¸ì–´ê°€ ë°”ë€Œì–´ë„ API ì¸í„°í˜ì´ìŠ¤(Endpoint, Request/Response Body)ëŠ” ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ë‹¤.

### ğŸ’¾ SQL First Development

- ORM(JPA, SQLAlchemy)ì˜ ê°ì²´ ë§¤í•‘ ê¸°ëŠ¥ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ì¿¼ë¦¬ëŠ” `.sql` íŒŒì¼ì— ì‘ì„±í•˜ê³  `sqlc`ë¡œ ì½”ë“œë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í•œë‹¤.
- **Why?** ì–¸ì–´ êµì²´ ì‹œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(SQL)ì˜ ì´ì‹ì„±ì„ 100% ë³´ì¥í•˜ê¸° ìœ„í•¨.

### ğŸ³ Database Strategy

- **Physical:** 1ê°œì˜ PostgreSQL ì¸ìŠ¤í„´ìŠ¤ (ë¦¬ì†ŒìŠ¤ ì ˆì•½).
- **Logical:** ì„œë¹„ìŠ¤ë³„ë¡œ ì—„ê²©í•˜ê²Œ `Database` (ë˜ëŠ” `Schema`)ë¥¼ ë¶„ë¦¬.
- íƒ€ ì„œë¹„ìŠ¤ì˜ í…Œì´ë¸”ì— ì§ì ‘ `JOIN` ê¸ˆì§€. ì˜¤ì§ APIë¥¼ í†µí•´ì„œë§Œ ë°ì´í„° ì ‘ê·¼.

---

## 4. ì„±ëŠ¥ ê°œì„  ì‹œë‚˜ë¦¬ì˜¤ (Performance Optimization Roadmap)

> ê° ì‹œë‚˜ë¦¬ì˜¤ëŠ” **k6 ë¶€í•˜í…ŒìŠ¤íŠ¸**ë¡œ Before/After ì„±ëŠ¥ì„ ì •ëŸ‰ì ìœ¼ë¡œ ì¸¡ì •í•œë‹¤.
> ì‹¤ë¬´ ìŠ¤í† ë¦¬: **ë¬¸ì œ ë°œê²¬ ì¡°ê±´ â†’ ì›ì¸ ë¶„ì„ â†’ í•´ê²°ì±… ì ìš© â†’ ì„±ëŠ¥ ê²€ì¦**

---

### ğŸŸ¢ Easy (ë‚œì´ë„ í•˜) - ë¹ ë¥¸ ì„±ê³¼ ë‹¬ì„±

#### E1. UUID v4 â†’ v7 ì „í™˜

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | í•«ë”œ ì´ë²¤íŠ¸ë¡œ **ìƒí’ˆ ë“±ë¡ì´ ê¸‰ì¦**í•˜ë©´ì„œ INSERT ì„±ëŠ¥ì´ ì €í•˜ë¨. ë™ì¼ ì‹œê°„ ë‚´ ë“±ë¡ ê°€ëŠ¥í•œ ìƒí’ˆ ìˆ˜ê°€ ê°ì†Œ |
| **ì¦ìƒ** | ìƒí’ˆ ëŒ€ëŸ‰ ë“±ë¡ ì‹œ ì‘ë‹µì‹œê°„ ì ì§„ì  ì¦ê°€, DB CPU ì‚¬ìš©ë¥  ìƒìŠ¹ |
| **ì›ì¸ ë¶„ì„** | UUID v4ëŠ” ëœë¤ê°’ì´ë¼ B-Tree ì¸ë±ìŠ¤ì—ì„œ í˜ì´ì§€ ë¶„í• (page split)ì´ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒ |
| **í•´ê²°ì±…** | UUID v7 (ì‹œê°„ ê¸°ë°˜ ì •ë ¬)ìœ¼ë¡œ ì „í™˜í•˜ì—¬ ìˆœì°¨ì  INSERT ìœ ë„ |
| **ì¸¡ì • ë°©ë²•** | 10,000ê±´ ìƒí’ˆ INSERT í›„ p95 ì‘ë‹µì‹œê°„ ë¹„êµ |
| **k6 í…ŒìŠ¤íŠ¸** | `product-insert.js` - ëŒ€ëŸ‰ ìƒí’ˆ ìƒì„± ë¶€í•˜ |

#### E2. ìƒí’ˆ ëª©ë¡ ìºì‹± (Redis)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ë©”ì¸ í˜ì´ì§€ íŠ¸ë˜í”½ ì¦ê°€ë¡œ **ìƒí’ˆ ëª©ë¡ ì¡°íšŒ APIê°€ ë³‘ëª©**ì´ ë¨. DB ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ |
| **ì¦ìƒ** | GET /products ì‘ë‹µì‹œê°„ 500ms ì´ˆê³¼, DB ì»¤ë„¥ì…˜ ëŒ€ê¸° ë°œìƒ |
| **ì›ì¸ ë¶„ì„** | ë™ì¼í•œ ìƒí’ˆ ëª©ë¡ì„ ë§¤ ìš”ì²­ë§ˆë‹¤ DBì—ì„œ ì¡°íšŒ. ìƒí’ˆ ë°ì´í„°ëŠ” ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ |
| **í•´ê²°ì±…** | Redisì— ìƒí’ˆ ëª©ë¡ ìºì‹± (TTL 60ì´ˆ), Cache-Aside íŒ¨í„´ ì ìš© |
| **ì¸¡ì • ë°©ë²•** | 100 VUë¡œ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ, Cache Hit ì‹œ p95 < 50ms ëª©í‘œ |
| **k6 í…ŒìŠ¤íŠ¸** | `product-list.js` - ìƒí’ˆ ëª©ë¡ ë°˜ë³µ ì¡°íšŒ ë¶€í•˜ |

#### E3. í•«ë”œ ëª©ë¡ ìºì‹± (Redis)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | í•«ë”œ ì‹œì‘ ì‹œê°„ì— **GET /products/deals íŠ¸ë˜í”½ì´ 10ë°° ê¸‰ì¦**. ì„œë¹„ìŠ¤ ì‘ë‹µ ì§€ì—° |
| **ì¦ìƒ** | í•«ë”œ ì¡°íšŒ API Timeout ë°œìƒ, ì—ëŸ¬ìœ¨ ìƒìŠ¹ |
| **ì›ì¸ ë¶„ì„** | í•«ë”œì€ ì‹œê°„ ì¡°ê±´ + JOIN ì¿¼ë¦¬ë¡œ ìƒí’ˆ ëª©ë¡ë³´ë‹¤ ë¬´ê±°ì›€. ë™ì‹œ ì‚¬ìš©ìê°€ ê°™ì€ ë°ì´í„° ìš”ì²­ |
| **í•´ê²°ì±…** | Redis ìºì‹± + í•«ë”œ ì‹œì‘ ì „ Cache Warming ì „ëµ |
| **ì¸¡ì • ë°©ë²•** | í•«ë”œ ì‹œì‘ ì‹œì  ì‹œë®¬ë ˆì´ì…˜, 200 VU ë™ì‹œ ì ‘ì† |
| **k6 í…ŒìŠ¤íŠ¸** | `deal-list.js` - í•«ë”œ ëª©ë¡ ì§‘ì¤‘ ì¡°íšŒ ë¶€í•˜ |

#### E4. N+1 ì¿¼ë¦¬ í•´ê²° (Order Items)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ì£¼ë¬¸ ë‚´ì—­ í˜ì´ì§€ì—ì„œ **ì£¼ë¬¸ì´ ë§ì€ ì‚¬ìš©ìì˜ ì¡°íšŒê°€ ê·¹ë„ë¡œ ëŠë¦¼** |
| **ì¦ìƒ** | ì£¼ë¬¸ 20ê±´ ì¡°íšŒ ì‹œ ì‘ë‹µì‹œê°„ 2ì´ˆ ì´ìƒ, ì£¼ë¬¸ ìˆ˜ì— ë¹„ë¡€í•´ ëŠë ¤ì§ |
| **ì›ì¸ ë¶„ì„** | ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ í›„ ê° ì£¼ë¬¸ë§ˆë‹¤ order_itemsë¥¼ ë³„ë„ ì¿¼ë¦¬ (N+1 ë¬¸ì œ) |
| **í•´ê²°ì±…** | JOIN ì¿¼ë¦¬ë¡œ í•œ ë²ˆì— ì¡°íšŒí•˜ê±°ë‚˜, IN ì ˆë¡œ ë°°ì¹˜ ë¡œë”© |
| **ì¸¡ì • ë°©ë²•** | ì£¼ë¬¸ 50ê±´ ë³´ìœ  ì‚¬ìš©ìì˜ ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ì„±ëŠ¥ |
| **k6 í…ŒìŠ¤íŠ¸** | `order-list.js` - ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ë¶€í•˜ (ë‹¤ëŸ‰ ì£¼ë¬¸ ì‚¬ìš©ì) |

#### E5. Connection Pool íŠœë‹

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ë™ì‹œ ì‚¬ìš©ì 100ëª… ì´ìƒì—ì„œ **"connection pool exhausted" ì—ëŸ¬** ë°œìƒ |
| **ì¦ìƒ** | ê°„í—ì  500 ì—ëŸ¬, ì‘ë‹µì‹œê°„ ë¶ˆì•ˆì • |
| **ì›ì¸ ë¶„ì„** | ê¸°ë³¸ Connection Pool í¬ê¸°ê°€ ë™ì‹œ ìš”ì²­ ìˆ˜ë¥¼ ê°ë‹¹ ëª»í•¨ |
| **í•´ê²°ì±…** | Pool í¬ê¸° ì¡°ì • (min/max), Connection ì¬ì‚¬ìš© ìµœì í™” |
| **ì¸¡ì • ë°©ë²•** | ë™ì‹œ VU ì¦ê°€ì‹œí‚¤ë©° ì—ëŸ¬ ë°œìƒ ì„ê³„ì  í™•ì¸ |
| **k6 í…ŒìŠ¤íŠ¸** | `health-check.js` stress ëª¨ë“œ - ë™ì‹œ ì—°ê²° í•œê³„ í…ŒìŠ¤íŠ¸ |

#### E6. Response ì••ì¶• (gzip)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ëª¨ë°”ì¼ ì‚¬ìš©ìì—ì„œ **ìƒí’ˆ ëª©ë¡ ë¡œë”©ì´ ëŠë¦¼**. ë„¤íŠ¸ì›Œí¬ ì§€ì—° |
| **ì¦ìƒ** | ìƒí’ˆ 100ê±´ ì‘ë‹µì´ 500KB ì´ìƒ, 3G í™˜ê²½ì—ì„œ ì²´ê° ëŠë¦¼ |
| **ì›ì¸ ë¶„ì„** | JSON ì‘ë‹µì„ ì••ì¶• ì—†ì´ ì „ì†¡. íŠ¹íˆ ëª©ë¡ APIì—ì„œ ë°ì´í„°ëŸ‰ í¼ |
| **í•´ê²°ì±…** | FastAPIì— GZip ë¯¸ë“¤ì›¨ì–´ ì ìš© (minimum_size=1000) |
| **ì¸¡ì • ë°©ë²•** | ì‘ë‹µ í¬ê¸° ë¹„êµ (ì••ì¶• ì „/í›„), ë„¤íŠ¸ì›Œí¬ ì „ì†¡ ì‹œê°„ |
| **k6 í…ŒìŠ¤íŠ¸** | `product-list.js` - ì‘ë‹µ í¬ê¸° ë° ì „ì†¡ ì‹œê°„ ì¸¡ì • |

#### E7. Pagination COUNT ìºì‹±

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ìƒí’ˆì´ 100ë§Œ ê±´ ì´ìƒì¼ ë•Œ **ëª©ë¡ APIê°€ ëŠë ¤ì§** |
| **ì¦ìƒ** | í˜ì´ì§€ ì´ë™ë§ˆë‹¤ 300ms+ ì†Œìš”, ì²« í˜ì´ì§€ë„ ëŠë¦¼ |
| **ì›ì¸ ë¶„ì„** | ë§¤ ìš”ì²­ë§ˆë‹¤ COUNT(*) ì¿¼ë¦¬ ì‹¤í–‰. ëŒ€ëŸ‰ ë°ì´í„°ì—ì„œ Full Scan |
| **í•´ê²°ì±…** | Total Countë¥¼ Redisì— ìºì‹±, ìƒí’ˆ ë³€ê²½ ì‹œ ê°±ì‹  (ë˜ëŠ” ê·¼ì‚¬ê°’ ì‚¬ìš©) |
| **ì¸¡ì • ë°©ë²•** | 100ë§Œ ê±´ ìƒí’ˆ í…Œì´ë¸”ì—ì„œ í˜ì´ì§€ë„¤ì´ì…˜ ì„±ëŠ¥ |
| **k6 í…ŒìŠ¤íŠ¸** | `product-list.js` - ëŒ€ëŸ‰ ë°ì´í„° í˜ì´ì§€ë„¤ì´ì…˜ |

---

### ğŸŸ¡ Medium (ë‚œì´ë„ ì¤‘) - ì•„í‚¤í…ì²˜ ê°œì„ 

#### M1. ë¶„ì‚° ë½ (Redlock)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ì¸ê¸° í•«ë”œì— **100ëª…ì´ ë™ì‹œ ì£¼ë¬¸ ì‹œ ì¬ê³ ê°€ ìŒìˆ˜**ê°€ ë¨ |
| **ì¦ìƒ** | ì¬ê³  10ê°œ ìƒí’ˆì— 15ê±´ ì£¼ë¬¸ ì„±ê³µ. ë°ì´í„° ì •í•©ì„± ê¹¨ì§ |
| **ì›ì¸ ë¶„ì„** | DBì˜ `FOR UPDATE` ë½ë§Œìœ¼ë¡œ ë¶„ì‚° í™˜ê²½ì—ì„œ ë™ì‹œì„± ì œì–´ ë¶ˆì¶©ë¶„ |
| **í•´ê²°ì±…** | Redis ë¶„ì‚° ë½ (Redlock) ë„ì…, ì¬ê³  ì°¨ê° ì „ ë½ íšë“ |
| **ì¸¡ì • ë°©ë²•** | ì¬ê³  10ê°œ ìƒí’ˆì— 100ëª… ë™ì‹œ ì£¼ë¬¸, ì •í™•íˆ 10ê±´ë§Œ ì„±ê³µ ê²€ì¦ |
| **k6 í…ŒìŠ¤íŠ¸** | `concurrent-order.js` - ë™ì‹œ ì£¼ë¬¸ Race Condition í…ŒìŠ¤íŠ¸ |

#### M2. JWT ê²€ì¦ ìºì‹±

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ì¸ì¦ëœ API í˜¸ì¶œë§ˆë‹¤ **JWT ê²€ì¦ ì˜¤ë²„í—¤ë“œ**ê°€ ëˆ„ì ë¨ |
| **ì¦ìƒ** | ë™ì¼ í† í°ìœ¼ë¡œ 100ë²ˆ ìš”ì²­í•´ë„ ë§¤ë²ˆ ì„œëª… ê²€ì¦ ìˆ˜í–‰ |
| **ì›ì¸ ë¶„ì„** | JWT RS256 ì„œëª… ê²€ì¦ì€ CPU ì—°ì‚° ë¹„ìš©ì´ ë†’ìŒ |
| **í•´ê²°ì±…** | ê²€ì¦ëœ í† í°ì„ Redisì— ìºì‹± (í† í° í•´ì‹œ â†’ ì‚¬ìš©ì ì •ë³´) |
| **ì¸¡ì • ë°©ë²•** | ì¸ì¦ API 1000íšŒ í˜¸ì¶œ ì‹œ Gateway CPU ì‚¬ìš©ë¥  ë¹„êµ |
| **k6 í…ŒìŠ¤íŠ¸** | `auth-flow.js` - ë°˜ë³µì ì¸ ì¸ì¦ API í˜¸ì¶œ |

#### M3. DB Index íŠœë‹

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | íŠ¹ì • ì¡°íšŒ ì¿¼ë¦¬ì—ì„œ **Slow Query ë¡œê·¸** ë‹¤ìˆ˜ ë°œìƒ |
| **ì¦ìƒ** | ì£¼ë¬¸ ìƒíƒœë³„ ì¡°íšŒ, ë‚ ì§œ ë²”ìœ„ ì¡°íšŒ ë“±ì—ì„œ 1ì´ˆ ì´ìƒ ì†Œìš” |
| **ì›ì¸ ë¶„ì„** | ë³µí•© ì¡°ê±´ ì¿¼ë¦¬ì— ì ì ˆí•œ ì¸ë±ìŠ¤ ë¶€ì¬, Full Table Scan ë°œìƒ |
| **í•´ê²°ì±…** | EXPLAIN ANALYZEë¡œ ì‹¤í–‰ê³„íš ë¶„ì„, ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€ |
| **ì¸¡ì • ë°©ë²•** | ë¬¸ì œ ì¿¼ë¦¬ Before/After ì‹¤í–‰ ì‹œê°„ ë¹„êµ |
| **k6 í…ŒìŠ¤íŠ¸** | `order-scenario.js` - ë‹¤ì–‘í•œ ì¡°íšŒ ì¡°ê±´ í…ŒìŠ¤íŠ¸ |

#### M4. Rate Limiting

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | í•«ë”œ ì‹œì‘ ì‹œ **íŠ¸ë˜í”½ í­ì£¼ë¡œ ì „ì²´ ì„œë¹„ìŠ¤ ë‹¤ìš´** |
| **ì¦ìƒ** | ì •ìƒ ì‚¬ìš©ìë„ ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€, ì—°ì‡„ ì¥ì•  ë°œìƒ |
| **ì›ì¸ ë¶„ì„** | íŠ¸ë˜í”½ ì œí•œ ì—†ì´ ëª¨ë“  ìš”ì²­ ì²˜ë¦¬ ì‹œë„, ë¦¬ì†ŒìŠ¤ ê³ ê°ˆ |
| **í•´ê²°ì±…** | Gatewayì— Rate Limiting ì ìš© (IPë‹¹ 100 req/s, ì‚¬ìš©ìë‹¹ 50 req/s) |
| **ì¸¡ì • ë°©ë²•** | ì œí•œ ì´ˆê³¼ ì‹œ 429 ì‘ë‹µ, ì œí•œ ë‚´ì—ì„œ ì•ˆì •ì  TPS ìœ ì§€ í™•ì¸ |
| **k6 í…ŒìŠ¤íŠ¸** | `stress-test.js` - ê³¼ë¶€í•˜ ìƒí™©ì—ì„œ ì•ˆì •ì„± í…ŒìŠ¤íŠ¸ |

#### M5. Circuit Breaker

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | Product Service ì¥ì•  ì‹œ **Order Serviceë„ ì—°ì‡„ ì¥ì• ** ë°œìƒ |
| **ì¦ìƒ** | Product ì‘ë‹µ ì§€ì—° â†’ Order íƒ€ì„ì•„ì›ƒ â†’ Gateway íƒ€ì„ì•„ì›ƒ â†’ ì „ì²´ ë§ˆë¹„ |
| **ì›ì¸ ë¶„ì„** | ë™ê¸° HTTP í˜¸ì¶œì—ì„œ ì¥ì•  ì„œë¹„ìŠ¤ë¡œ ê³„ì† ìš”ì²­ ì‹œë„ |
| **í•´ê²°ì±…** | Circuit Breaker íŒ¨í„´ ì ìš© (ì‹¤íŒ¨ìœ¨ 50% ì´ìƒ ì‹œ ì°¨ë‹¨, 30ì´ˆ í›„ ì¬ì‹œë„) |
| **ì¸¡ì • ë°©ë²•** | Product Service ê°•ì œ ë‹¤ìš´ í›„ Order Service ì‘ë‹µ í™•ì¸ |
| **k6 í…ŒìŠ¤íŠ¸** | `service-failure.js` - ì„œë¹„ìŠ¤ ì¥ì•  ì‹œë®¬ë ˆì´ì…˜ |

---

### ğŸ”´ Hard (ë‚œì´ë„ ìƒ) - ëŒ€ê·œëª¨ ì•„í‚¤í…ì²˜ ë³€ê²½

#### H1. gRPC ì „í™˜ (ì„œë¹„ìŠ¤ ê°„ í†µì‹ )

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ì£¼ë¬¸ ìƒì„± ì‹œ **Product Service í˜¸ì¶œ ì§€ì—°ì´ ì „ì²´ ì‘ë‹µì‹œê°„ì˜ 60%** ì°¨ì§€ |
| **ì¦ìƒ** | ì£¼ë¬¸ API p95ê°€ 800msì¸ë°, ê·¸ ì¤‘ Product API í˜¸ì¶œì´ 500ms |
| **ì›ì¸ ë¶„ì„** | HTTP/1.1 + JSON ì§ë ¬í™” ì˜¤ë²„í—¤ë“œ, ë§¤ ìš”ì²­ë§ˆë‹¤ ì—°ê²° ì„¤ì • |
| **í•´ê²°ì±…** | gRPC (HTTP/2 + Protocol Buffers) ì „í™˜, ì—°ê²° ì¬ì‚¬ìš© |
| **ì¸¡ì • ë°©ë²•** | ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì§€ì—° ì‹œê°„ ì¸¡ì • (HTTP vs gRPC) |
| **k6 í…ŒìŠ¤íŠ¸** | `inter-service.js` - ì„œë¹„ìŠ¤ ê°„ í˜¸ì¶œ í¬í•¨ ì‹œë‚˜ë¦¬ì˜¤ |

#### H2. Kafka ë¹„ë™ê¸° ì²˜ë¦¬ (ì£¼ë¬¸)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | í•«ë”œ ì‹œì‘ ì‹œ **ì£¼ë¬¸ ì²˜ë¦¬ëŸ‰ í•œê³„ (100 TPS)ì— ë„ë‹¬** |
| **ì¦ìƒ** | ë™ê¸° ì²˜ë¦¬ë¡œ ì¸í•´ DB íŠ¸ëœì­ì…˜ ëŒ€ê¸°, TPS ì¦ê°€ ë¶ˆê°€ |
| **ì›ì¸ ë¶„ì„** | ì£¼ë¬¸ ìƒì„± = ì¬ê³ í™•ì¸ + ì¬ê³ ì°¨ê° + ì£¼ë¬¸ì €ì¥ì´ ë™ê¸°ì ìœ¼ë¡œ ì—°ê²° |
| **í•´ê²°ì±…** | ì£¼ë¬¸ ìš”ì²­ì„ Kafkaë¡œ ë¹„ë™ê¸° ì²˜ë¦¬, ìµœì¢… ì¼ê´€ì„±(Eventual Consistency) ëª¨ë¸ |
| **ì¸¡ì • ë°©ë²•** | ì£¼ë¬¸ ìš”ì²­ TPS vs ì‹¤ì œ ì²˜ë¦¬ ì™„ë£Œ TPS ë¹„êµ |
| **k6 í…ŒìŠ¤íŠ¸** | `async-order.js` - ëŒ€ëŸ‰ ì£¼ë¬¸ ì²˜ë¦¬ëŸ‰ í…ŒìŠ¤íŠ¸ |

#### H3. Python â†’ Go (Auth Service)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ë¡œê·¸ì¸ íŠ¸ë˜í”½ ì¦ê°€ ì‹œ **Auth Service CPU 100%** ë„ë‹¬ |
| **ì¦ìƒ** | JWT ìƒì„±/ê²€ì¦ ìš”ì²­ì´ ë§ì•„ì§€ë©´ Python GILë¡œ ì¸í•œ ë³‘ëª© |
| **ì›ì¸ ë¶„ì„** | JWT ì•”í˜¸í™”ëŠ” CPU-bound ì‘ì—…, Pythonì€ ë©€í‹°ì½”ì–´ í™œìš© ì œí•œ |
| **í•´ê²°ì±…** | Goë¡œ Auth Service ì¬ì‘ì„± (goroutineìœ¼ë¡œ ë³‘ë ¬ ì²˜ë¦¬) |
| **ì¸¡ì • ë°©ë²•** | ë™ì¼ í•˜ë“œì›¨ì–´ì—ì„œ ë¡œê·¸ì¸ API TPS ë¹„êµ |
| **k6 í…ŒìŠ¤íŠ¸** | `auth-flow.js` - ì¸ì¦ API ìµœëŒ€ ì²˜ë¦¬ëŸ‰ í…ŒìŠ¤íŠ¸ |

#### H4. Python â†’ Go (Order Service)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | ì£¼ë¬¸ ì„œë¹„ìŠ¤ê°€ **ì „ì²´ ì‹œìŠ¤í…œì˜ ë³‘ëª©** (ê°€ì¥ ë‚®ì€ TPS) |
| **ì¦ìƒ** | Auth, ProductëŠ” ì—¬ìœ  ìˆëŠ”ë° Orderì—ì„œ ëŒ€ê¸°ì—´ ë°œìƒ |
| **ì›ì¸ ë¶„ì„** | ì£¼ë¬¸ì€ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ í˜¸ì¶œ + DB íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë³µì¡, Python ì„±ëŠ¥ í•œê³„ |
| **í•´ê²°ì±…** | Goë¡œ Order Service ì¬ì‘ì„±, I/O ë©€í‹°í”Œë ‰ì‹± ìµœì í™” |
| **ì¸¡ì • ë°©ë²•** | ì „ì²´ ì£¼ë¬¸ í”Œë¡œìš° TPS ë¹„êµ (Python vs Go) |
| **k6 í…ŒìŠ¤íŠ¸** | `order-scenario.js` - ì „ì²´ ì£¼ë¬¸ ì‹œë‚˜ë¦¬ì˜¤ ì²˜ë¦¬ëŸ‰ |

#### H5. Kong Gateway ì „í™˜

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¬¸ì œ ë°œê²¬** | Python Gatewayê°€ **ë†’ì€ íŠ¸ë˜í”½ì—ì„œ ë³‘ëª©**ì´ ë¨ |
| **ì¦ìƒ** | ëª¨ë“  ìš”ì²­ì´ Gatewayë¥¼ ê²½ìœ í•˜ë¯€ë¡œ, Gateway TPS = ì „ì²´ ì‹œìŠ¤í…œ TPS ìƒí•œ |
| **ì›ì¸ ë¶„ì„** | Python + httpx ê¸°ë°˜ í”„ë¡ì‹œì˜ ì²˜ë¦¬ëŸ‰ í•œê³„ |
| **í•´ê²°ì±…** | Kong Gateway (Nginx + Lua ê¸°ë°˜) ë˜ëŠ” Envoyë¡œ ì „í™˜ |
| **ì¸¡ì • ë°©ë²•** | Gateway ë‹¨ë… ì²˜ë¦¬ëŸ‰ ì¸¡ì • (í”„ë¡ì‹œ ì„±ëŠ¥) |
| **k6 í…ŒìŠ¤íŠ¸** | `gateway-throughput.js` - Gateway ìµœëŒ€ ì²˜ë¦¬ëŸ‰ í…ŒìŠ¤íŠ¸ |

---

## 5. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (k6 Scripts)

> `tests/load/scripts/` ë””ë ‰í† ë¦¬

### ì‹œë‚˜ë¦¬ì˜¤ë³„ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

| ì™„ë£Œ | ì‹œë‚˜ë¦¬ì˜¤ | ìŠ¤í¬ë¦½íŠ¸ | íƒ€ê²Ÿ ê°œì„ ì‚¬í•­ |
|:----:|----------|----------|---------------|
| | [ìƒí’ˆ ëª©ë¡ ì¡°íšŒê°€ ëŠë¦¼](../docs/scenarios/product-list-slow.md) | `product-list.js` | E2, E6, E7 |
| âœ… | [ìƒí’ˆ ëŒ€ëŸ‰ ë“±ë¡ì´ ëŠë¦¼](../docs/scenarios/product-insert-slow.md) | `product-insert.js` | E1 |
| | [ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒê°€ ëŠë¦¼](../docs/scenarios/order-list-slow.md) | `order-list.js` | E4, M3 |
| | [í•«ë”œ íŠ¸ë˜í”½ ê¸‰ì¦](../docs/scenarios/deal-traffic-spike.md) | `deal-spike.js` | E3, M4 |
| | [ë™ì‹œ ì£¼ë¬¸ ì¬ê³  ì´ˆê³¼](../docs/scenarios/concurrent-order-oversell.md) | `concurrent-order.js` | M1 |
| | [DB ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ](../docs/scenarios/connection-pool-exhausted.md) | `connection-stress.js` | E5 |
| | [ì„œë¹„ìŠ¤ ì¥ì•  ì—°ì‡„ ì „íŒŒ](../docs/scenarios/service-cascade-failure.md) | `service-failure.js` | M5 |
| | [ì¸ì¦ CPU ë³‘ëª©](../docs/scenarios/auth-cpu-bottleneck.md) | `auth-stress.js` | M2, H3 |
| | [ì£¼ë¬¸ ì²˜ë¦¬ëŸ‰ í•œê³„](../docs/scenarios/order-tps-limit.md) | `order-stress.js` | H1, H2, H4 |
| | [Gateway ì²˜ë¦¬ëŸ‰ í•œê³„](../docs/scenarios/gateway-throughput-limit.md) | `gateway-throughput.js` | H5 |

### ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸
| ìŠ¤í¬ë¦½íŠ¸ | ìš©ë„ |
|----------|------|
| `health-check.js` | ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ |
| `auth-flow.js` | íšŒì›ê°€ì…â†’ë¡œê·¸ì¸â†’ë‚´ì •ë³´â†’í† í°ê°±ì‹  |
| `order-scenario.js` | ì „ì²´ ì£¼ë¬¸ í”Œë¡œìš° |

### ì¸¡ì • ì§€í‘œ
- **Throughput (TPS)**: ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰
- **Latency**: p50, p95, p99 ì‘ë‹µì‹œê°„
- **Error Rate**: ì—ëŸ¬ ë¹„ìœ¨
- **Resource Usage**: CPU, Memory (Docker stats)
