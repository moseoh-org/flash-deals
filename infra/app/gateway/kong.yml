_format_version: "3.0"
_transform: true

# ===================
# Services
# ===================
services:
  # ===================
  # Auth Service
  # ===================
  - name: auth-service
    url: http://auth:8001
    routes:
      - name: auth-routes
        paths:
          - /auth
        strip_path: false

  # ===================
  # Product Service
  # ===================
  - name: product-service
    url: http://product:8002
    routes:
      - name: product-routes
        paths:
          - /products
        strip_path: false

  # ===================
  # Order Service
  # ===================
  - name: order-service
    url: http://order:8003
    routes:
      - name: order-routes
        paths:
          - /orders
        strip_path: false

plugins:
  # ===================
  # Global Plugins
  # ===================
  - name: opentelemetry
    config:
      traces_endpoint: http://otel-collector:4318/v1/traces
      resource_attributes:
        service.name: gateway
        service.namespace: flash-deals
        deployment.environment: development
      propagation:
        default_format: w3c

  - name: prometheus
    config:
      per_consumer: false
      status_code_metrics: true
      latency_metrics: true
      bandwidth_metrics: true
      upstream_health_metrics: true
